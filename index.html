<!DOCTYPE html>
<html>
<head>
  <title>GitHub Login with Whitelist</title>
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-app.js";
    import {
      getAuth,
      GithubAuthProvider,
      signInWithRedirect,
      getRedirectResult,
      onAuthStateChanged,
      signOut
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-auth.js";
    import {
      getFirestore,
      doc,
      getDoc
    } from "https://www.gstatic.com/firebasejs/10.11.0/firebase-firestore.js";
const firebaseConfig = {
    apiKey: "AIzaSyCVLDlhnQE4qogdVnF3TZdF-VC_mQdK6uE",
    authDomain: "logindb-543c4.firebaseapp.com",
    projectId: "logindb-543c4",
    storageBucket: "logindb-543c4.firebasestorage.app",
    messagingSenderId: "933105724056",
    appId: "1:933105724056:web:f0953859f728fd448cbeed"
  };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);
    const provider = new GithubAuthProvider();

    // Login function
    window.login = () => {
      signInWithRedirect(auth, provider);
    };

    // Handle redirect result
    getRedirectResult(auth).catch(console.error);

    // After login, check Firestore whitelist
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const email = user.email;
        const whitelistByEmail = doc(db, "whitelist", email);

        const [emailSnap] = await Promise.all([
          getDoc(whitelistByEmail),
          
        ]);

        if (emailSnap.exists() ) {
          document.getElementById("output").textContent =
            `Welcome, ${user.displayName}`;
        } else {
          alert("Access denied. You are not whitelisted.");
          await signOut(auth);
        }
      }
    });
  </script>
</head>
<body>
  <h1>GitHub Login (with whitelist)</h1>
  <button onclick="login()">Login with GitHub</button>
  <p id="output"></p>
</body>
</html>